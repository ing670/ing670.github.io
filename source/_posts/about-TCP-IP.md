---
title: 聊聊TCP/IP协议
date: 2017-05-26 09:58:13
tags:
- 网络原理
- tcp/ip
---
### 为什么会有TCP/IP协议
为了解决电脑或者说互联网设备在网络中通信的问题
### TCP/IP协议的4层模型
应用层，传输层，互连网络层，网络接口层
其中“应用层”是对应着网络协议ISO七层“应用层，表示层，会话层”(网络传输ISO七层模型：应用层，表示层，会话层，传输层，网络层，数据链路层，物理层)
虽然国际标准化组织制定了这样一个网络协议的模型，但是实际上互联网通讯使用的网络协议是TCP/IP网络协议。
### 那么TCP/IP协议和OSI模型有什么区别呢
OSI网络协议模型，是一个参考模型，而TCP/IP协议是事实上的标准。TCP/IP协议参考了OSI 模型，但是并没有严格按照OSI规定的七层去划分标准，而只划分了四层，个人觉得这样会更简单点，当划分太多层次时，你很难区分某个协议是属于哪个层次 的。TCP/IP协议和OSI模型也并不冲突，TCP/IP协议中的应用层协议，就对应于OSI中的应用层，表示层，会话层。就像以前有工业部和信息产业 部，现在实行大部制后只有工业和信息化部一个部门，但是这个部门还是要做以前两个部门一样多的事情，本质上没有多大的差别。TCP/IP中有两个重要的协 议，传输层的TCP协议和互连网络层的IP协议，因此就拿这两个协议做代表，来命名整个协议族了，在说TCP/IP协议时，是指整个协议族。
### TCP/IP传输层
传输层有多个协议，但最主要的是TCP和UDP协议。两则的区别在于TCP协议需要接收方反馈，UDP协议不需要接收方反馈。TCP就像挂号 信，A电脑发信息给B电脑后，需要得到B电脑的反馈，这样A电脑就能知道B电脑是否已经收到信息。UDP就像平信，A电脑发信息给B电脑后，B电脑并不给 A电脑反聩，A电脑发送信息出去后并不知道B电脑是否已经收到。 因此，TCP传输比UDP传送更可靠，但是TCP传输的效率就不如UDP了。至于，在传送过程中具体选择哪种传送方式，需要具体问题具体分析。在不可靠的 网络传送过程中一般选择TCP传送方式。在讲求效率，或者不在乎传送失误的情况下可以选择UDP方式来提高传输速率。
### TCP/IP应用层
HTTP协议，万维网服务。FTP协议，文件传送服务。POP3，邮件服务，SOAP协议webService服务，websocket等等
一般我们自定义的协议都在这个层里
### TCP建立链接的3次握手和4次挥手
![示例图](/images/0_131271823564Rx.gif)
#### TCP建立连接的3次握手
1. 客户端syn(同步信号)给服务端
2. 服务端做出回应ack(应答信号)+syn(同步信号)
3. 客户端做出回应ack(应答信号)
这样就建立起tcp连接，之后是传输数据
#### 为什么需要“三次握手”
谢希仁版《计算机网络》中的例子是这样的，“已失效的连接请求报文段”的产生在这样一种情况下：client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。本来这是一个早已失效的报文段。但server收到此失效的连接请求报文段后，就误认为是client再次发出的一个新的连接请求。于是就向client发出确认报文段，同意建立连接。假设不采用“三次握手”，那么只要server发出确认，新的连接就建立了。由于现在client并没有发出建立连接的请求，因此不会理睬server的确认，也不会向server发送数据。但server却以为新的运输连接已经建立，并一直等待client发来数据。这样，server的很多资源就白白浪费掉了。采用“三次握手”的办法可以防止上述现象发生。例如刚才那种情况，client不会向server的确认发出确认。server由于收不到确认，就知道client并没有要求建立连接。”。`主要目的防止server端一直等待，浪费资源。`
#### 断开tcp连接4次挥手
注意：断开tcp连接这个发起者有可能是服务端，也有可能是客户端，这里以客户端为例子：
1. 客户端发起fin请求(断开请求)
2. 服务端做出ack(应答信号)
3. 服务端做出fin(断开请求)
4. 客户端做出ack请求(断开请求)
#### 为什么需要4次挥手
因为tcp是全双工模式，接收到FIN时意味将没有数据再发来，但是还是可以继续发送数据。
为了确定数据已经传输完整，在传输完了之后要需要做一个ack回应
#### 为什么TIME_WAIT状态需要经过2MSL(最大报文段生存时间)才能返回到CLOSE状态？
虽然按道理，四个报文都发送完毕，我们可以直接进入CLOSE状态了，但是我们必须假象网络是不可靠的，有可以最后一个ACK丢失。所以TIME_WAIT状态就是用来重发可能丢失的ACK报文。
### 相关参考资料
 [TCP为什么需要3次握手与4次挥手](http://blog.csdn.net/xifeijian/article/details/12777187)
 [TCP协议中的三次握手和四次挥手(图解)](http://blog.csdn.net/whuslei/article/details/6667471)
 [对TCP/IP网络协议的深入浅出归纳](http://www.cnblogs.com/visec479/p/3872486.html)
